# PR-20 Mandate — Drop Legacy Columns

## Objective
Safely remove legacy time columns (`start_at`, `end_at`, etc.) from the schema after the shadow-read validation period.  
Guarantee that all data is fully migrated, discrepancies resolved, and only canonical UTC columns remain.

---

## Scope
- **Migration Script:**
  - Add a SQL migration that drops legacy time columns from `events` and related tables.
  - Preconditions: refuse to run if any events still lack UTC values (`*_utc` null).
  - Abort migration with actionable error if preconditions not met.
- **Startup Guard:**
  - At application boot, check schema: if legacy columns remain, show warning and block startup until migration applied.
- **Schema Update:**
  - Update Rust models and TypeScript bindings to remove references to dropped columns.
  - Ensure IPC commands and repos no longer expect legacy fields.
- **Documentation:**
  - `/docs/drop-legacy.md` with:
    - Preconditions for safe removal.
    - Migration steps.
    - Rollback steps.
    - Validation queries for operators.

---

## Non-Goals
- No changes to backfill or shadow-read logic (already handled in PR-19).  
- No UX adjustments beyond startup error if migration not applied.  
- No automatic repair of missing UTC values — operator must fix before migration.  

---

## Acceptance Criteria
1. **Migration:** Legacy columns dropped cleanly; migration aborts with error if null UTC values remain.  
2. **Startup Guard:** App fails fast if schema still has legacy columns after PR-20 migration expected.  
3. **Schema Clean:** No code references to legacy fields; Rust/TS models updated.  
4. **IPC Consistency:** Responses only include UTC values; no legacy fallbacks.  
5. **Documentation:** `/docs/drop-legacy.md` explains steps, prerequisites, and rollback.  
6. **Tests:** Migration tests confirm failure when preconditions unmet and success otherwise.  

---

## Evidence Required in PR
- **Migration Demo (Fail):** Run migration on DB with null UTC values → abort with clear error.  
- **Migration Demo (Pass):** Run migration on fully backfilled DB → columns dropped, schema clean.  
- **Startup Proof:** Log excerpt of app refusing to start when legacy columns present.  
- **Schema Proof:** Show updated Rust/TS models without legacy fields.  
- **Doc Proof:** `/docs/drop-legacy.md` included with detailed operator guidance.  

---

## Rollback Plan
- Provide inverse migration script to reintroduce dropped columns (empty or with defaults).  
- Update docs with rollback procedure.  
- Rollback feasible but risks losing original wall-clock intent if legacy data already deleted.  

---

## PR Title / Description
- **Title:** `chore(schema): drop legacy time columns after backfill and shadow-read`  
- **Body:** Must include Objective, Scope, Non-Goals, Acceptance Criteria, Evidence, and Rollback.

---
```
