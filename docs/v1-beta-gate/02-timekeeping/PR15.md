# PR-15 Mandate — Error Taxonomy Mapping for Timekeeping

## Objective
Ensure that all errors arising from timekeeping operations (recurrence expansion, EXDATE parsing, timezone backfill) are mapped to a **stable taxonomy** of codes and messages.  
Guarantee that users see clear, actionable feedback instead of raw technical errors.

---

## Scope
- **Backend Mapping:**
  - Standardise error codes for timekeeping failures, e.g.:
    - `E_EXDATE_INVALID_FORMAT`
    - `E_EXDATE_OUT_OF_RANGE`
    - `E_RRULE_UNSUPPORTED_FIELD`
    - `E_TZ_UNKNOWN`
    - `E_TZ_DRIFT_DETECTED`
  - Each code has a corresponding stable message and optional context fields.
- **IPC Integration:**
  - Normalise errors returned over IPC to include:
    - `code`
    - `message`
    - `context` (structured, e.g., offending string or field).
  - Ensure existing IPC `normalizeError` wrapper can surface these codes consistently.
- **UI Integration:**
  - Map error codes to user-facing, localisable messages:
    - EXDATE invalid → *“One or more excluded dates are invalid. Please check format (YYYY-MM-DD).”*
    - TZ unknown → *“This event has an unrecognised timezone. Please edit and select a valid timezone.”*
    - RRULE unsupported → *“This repeat pattern is not yet supported.”*
  - Display messages via the existing `ErrorBanner` primitive.
- **Documentation:**
  - New `/docs/time-errors.md` listing:
    - Error code
    - Developer message
    - User-facing copy
    - Recovery guidance

---

## Non-Goals
- No new EXDATE or RRULE logic — this is purely about error handling.  
- No localisation files delivered yet — English-only strings for v1.  
- No telemetry/analytics — errors remain local.  

---

## Acceptance Criteria
1. **Taxonomy Defined:** Stable list of timekeeping error codes added to codebase.  
2. **IPC Consistency:** All IPC timekeeping commands return structured errors with code/message/context.  
3. **UI Mapping:** ErrorBanner shows correct human-readable messages per code.  
4. **Test Coverage:** Unit tests assert error codes for known failure inputs; integration tests assert UI messages.  
5. **Documentation:** `/docs/time-errors.md` published with taxonomy and UX copy.  
6. **Backward Compatibility:** Legacy errors continue to surface without breaking API, but new taxonomy is preferred.  

---

## Evidence Required in PR
- **Backend Demo:** Log excerpt showing EXDATE parse failure → `E_EXDATE_INVALID_FORMAT`.  
- **IPC Demo:** JSON payload with `{ code: "E_TZ_UNKNOWN", message: "...", context: {...} }`.  
- **UI Demo:** Screenshot showing `ErrorBanner` with user-friendly copy.  
- **Test Proof:** Green run of unit + integration tests covering each code.  
- **Doc Proof:** `/docs/time-errors.md` included and reviewed.  

---

## Rollback Plan
- Remove error taxonomy definitions.  
- Revert IPC to passing raw error strings.  
- Delete `/docs/time-errors.md`.  
- Rollback leaves app functional but with inconsistent and unhelpful error surfaces.  

---

## PR Title / Description
- **Title:** `feat(errors): map timekeeping errors to stable taxonomy with UI messages`  
- **Body:** Must include Objective, Scope, Non-Goals, Acceptance Criteria, Evidence, and Rollback.

---
```
