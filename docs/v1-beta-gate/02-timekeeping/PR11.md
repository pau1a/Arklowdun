# PR-11 Mandate — EXDATE Application Tests

## Objective
Deliver a comprehensive suite of **tests** to prove that EXDATE values are correctly applied during recurrence expansion.  
Guarantee that excluded dates are removed consistently across timezones, DST transitions, and edge conditions.

---

## Scope
- Build unit and integration tests that cover:
  - **Single EXDATE removal:** Event instance exactly matching an EXDATE must not appear in expansion.
  - **Multiple EXDATEs:** Lists of exclusions applied in bulk, deduped correctly.
  - **Duplicates:** Duplicate EXDATEs do not cause double removal or errors.
  - **DST transitions:** Excluded dates near spring-forward or fall-back boundaries behave as intended.
  - **Leap days:** EXDATE on 29 Feb is respected, regardless of whether following year is leap or not.
- Add **fixture files** for reproducibility:
  - Example recurring event with defined RRULE and EXDATE set.
  - Expected output snapshot after expansion.
- Ensure both backend recurrence engine and IPC API return identical filtered results.

---

## Non-Goals
- No EXDATE normalisation logic changes (covered in PR-10).  
- No RDATE support (out of scope).  
- No UI copy or UX changes — this PR is test coverage only.  

---

## Acceptance Criteria
1. **Unit Tests:** Validate EXDATE logic at recurrence engine level.  
2. **Integration Tests:** Confirm IPC calls to `events_list_range` respect EXDATEs.  
3. **DST Edge Cases:** Events excluded correctly even when falling inside DST shifts.  
4. **Leap Day:** Events on 29 Feb correctly excluded, with recurrence continuing normally in following years.  
5. **Deterministic Output:** Snapshot results stable across runs; no random ordering introduced by EXDATE removal.  
6. **Fixture Storage:** Test fixtures and snapshots stored under `tests/exdate_fixtures/`.  
7. **CI Integration:** New tests run as part of `gate/rrule-matrix`; failure occurs on any regression.  
8. **Documentation:** `/docs/exdate-tests.md` records the test cases and expected behaviour.

---

## Evidence Required in PR
- **Failing Demo:** Test log where EXDATE is ignored (intentional bug injected) → test fails.  
- **Passing Demo:** Test log showing all assertions green.  
- **Snapshot Proof:** Example snapshot file with expected event list post-EXDATE.  
- **DST Case:** Log excerpt showing correct exclusion during spring-forward and fall-back.  
- **Doc Proof:** `/docs/exdate-tests.md` included with detailed case table.

---

## Rollback Plan
- Remove EXDATE test files and fixture snapshots.  
- Delete `/docs/exdate-tests.md`.  
- CI job continues running without EXDATE-specific coverage.  
- Rollback has no production impact but reintroduces untested behaviour.

---

## PR Title / Description
- **Title:** `test(exdate): add recurrence expansion tests for EXDATE exclusions`  
- **Body:** Must include Objective, Scope, Non-Goals, Acceptance Criteria, Evidence, and Rollback.

---
```
